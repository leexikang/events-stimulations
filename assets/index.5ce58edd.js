var w=Object.defineProperty;var q=(l,t,s)=>t in l?w(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var o=(l,t,s)=>(q(l,typeof t!="symbol"?t+"":t,s),s);const H=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function s(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerpolicy&&(n.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?n.credentials="include":e.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(e){if(e.ep)return;e.ep=!0;const n=s(e);fetch(e.href,n)}};H();class T{constructor(){o(this,"nodes");o(this,"nxt");this.nodes=[],this.nxt=0}size(){return this.nxt}isEmpty(){return this.nxt==0}enqueue(t){this.nodes[this.nxt]=t,this.swim(this.nxt),this.nxt++}dequeue(){if(this.isEmpty())return null;let t=this.nodes[0];return this.nodes[0]=this.nodes[this.nxt-1],this.nodes[this.nxt-1]=null,this.sink(0),this.nxt--,t}swim(t){let s=t;for(;;){let i=Math.floor(s/2);if(s>0&&this.less(i,s)){this.exchange(i,s),s=i;continue}break}}sink(t){let s=t;for(;;){let i=s*2;if(i+1>0&&this.less(i,i+1)&&(i=i+1),i<this.nxt&&this.less(s,i)){this.exchange(s,i),s=i;continue}break}}less(t,s){return this.nodes[s]==null?!1:this.nodes[t]==null?!0:this.nodes[t].compareTo?this.nodes[t].compareTo(this.nodes[s])<0:this.nodes[t]<this.nodes[s]}exchange(t,s){const i=this.nodes[t];this.nodes[t]=this.nodes[s],this.nodes[s]=i}}class d{constructor(t,s,i){o(this,"time");o(this,"a");o(this,"b");o(this,"countA");o(this,"countB");this.time=t,this.a=s,this.b=i,this.a!=null?this.countA=s.count:this.countA=-1,this.b!=null?this.countB=i.count:this.countB=-1}compareTo(t){return t.time-this.time}isValid(){return!(this.a!=null&&this.a.count!=this.countA||this.b!=null&&this.b.count!=this.countB)}}class W{constructor({canvas:t,balls:s,limit:i}){o(this,"canvas");o(this,"balls");o(this,"limit");o(this,"pq");o(this,"hz");o(this,"t");o(this,"ctx");this.canvas=t,this.balls=s,this.limit=i,this.t=0,this.hz=.5,this.pq=new T;const e=this.canvas.getContext("2d");if(e==null)throw new Error("Failed to get 2d context from the canvas.");this.ctx=e,this.pq.enqueue(new d(0,null,null));for(let n=0;n<this.balls.length;n++)this.predict(this.balls[n],i)}async stimulate(){for(;!this.pq.isEmpty();){const t=this.pq.dequeue();if(!t.isValid())continue;const s=t.a,i=t.b;for(let e=0;e<this.balls.length;e++)this.balls[e].move(t.time-this.t);this.t=t.time,s==null&&i==null&&await this.redraw(),s!=null&&i==null&&s.bounceOffHorizontalWall(),s==null&&i!=null&&i.bounceOffVerticalWall(),s!=null&&i!=null&&s.bounceOff(i),this.predict(s,this.limit),this.predict(i,this.limit)}}async redraw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.balls.length;t++)this.balls[t].draw();await new Promise(t=>setTimeout(t,30)),this.t<this.limit&&this.pq.enqueue(new d(this.t+1/this.hz,null,null))}predict(t,s){if(t==null)return;for(let n=0;n<this.balls.length;n++)this.pq.enqueue(new d(this.t+t.timeToHit(this.balls[n]),t,this.balls[n]));const i=t.timeToHitHorizontalTheWall(),e=t.timeToHitVerticalWall();this.t+i<=s&&this.pq.enqueue(new d(this.t+i,t,null)),this.t+e<=s&&this.pq.enqueue(new d(this.t+e,null,t))}}class O{constructor(t,s,i,e,n,h,c,r){o(this,"x");o(this,"y");o(this,"vx");o(this,"vy");o(this,"r");o(this,"count");o(this,"ctx");o(this,"maxWidth");o(this,"maxHeight");this.x=t,this.y=s,this.vx=i,this.vy=e,this.r=n,this.ctx=r,this.count=0,this.maxWidth=h,this.maxHeight=c}draw(){this.ctx.beginPath(),this.ctx.arc(this.x,this.y,5,0,2*Math.PI),this.ctx.fillStyle="#0095DD",this.ctx.fill(),this.ctx.closePath()}move(t){this.x+=this.vx*t,this.y+=this.vy*t}timeToHitHorizontalTheWall(){return this.vx>0?(this.maxWidth-this.r-this.x)/this.vx:this.vx<0?(this.x-this.r)/-this.vx:1/0}timeToHitVerticalWall(){return this.vy>0?(this.maxHeight-this.r-this.y)/this.vy:this.vy<0?(this.y-this.r)/-this.vy:1/0}timeToHit(t){if(this==t)return 1/0;const s=t.x-this.x,i=t.y-this.y,e=t.vx-this.vx,n=t.vy-this.vy,h=s*e+i*n;if(h>0)return 1/0;const c=e*e+n*n,r=s*s+i*i,u=this.r+t.r,a=h*h-c*(r-u*u);return a<0?1/0:-(h+Math.sqrt(a))/c}bounceOffHorizontalWall(){this.vx=-this.vx,this.count++}bounceOffVerticalWall(){this.vy=-this.vy,this.count++}bounceOff(t){const i=t.x-this.x,e=t.y-this.y,n=t.vx-this.vx,h=t.vy-this.vy,c=i*n+e*h,r=this.r+t.r,u=2*5*5*c/((5+5)*r),a=u*i/r,m=u*e/r;this.vx+=a/5,this.vy+=m/5,t.vx-=a/5,t.vy-=m/5,this.count++,t.count++}}const x=300,y=300;function M(l){const s=Math.random()*3+1,i=Math.random()*3+1,e=v(x,5),n=v(y,5);return new O(e,n,s,i,5,x,y,l)}function v(l,t){const s=l-t,i=t;return Math.floor(Math.random()*(s-i)+i)}const z=document.querySelector("#app");z.innerHTML=`
  <canvas id="stimulation" width="300" height="300"></canvas>
`;const f=document.getElementById("stimulation");f.style.border="1px solid black";const b=100,p=new Array(b);if(f!=null&&f.getContext){var g=f.getContext("2d");if(g!=null){for(let t=0;t<b;t++)p[t]=M(g);new W({canvas:f,balls:p,limit:1e4}).stimulate()}}
